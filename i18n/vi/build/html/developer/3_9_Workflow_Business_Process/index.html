


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Workflow-Business Process &mdash; Documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="Documentation" href="../../index.html" />
    <link rel="up" title="Developer Book" href="../index.html" />
    <link rel="next" title="Creating Wizard - (The Process)" href="../3_10_wizard/index.html" />
    <link rel="prev" title="Security" href="../2_7_menu_action/7_3_security.html" />
<script src="../../_static/tiny_js_kit_comment_control.js" type="text/javascript"></script>



 

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="../3_10_wizard/index.html" title="Creating Wizard - (The Process)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../2_7_menu_action/7_3_security.html" title="Security"
             accesskey="P">previous</a> |</li>

          <li><a href="../index.html" accesskey="U">Developer Book</a> &raquo;</li> 
      </ul>
    </div>
  <div class="openobject-header">
    <table cellspacing="0" cellpadding="0" border="0" width="1004">
      <tbody>
        <tr>
           <td width="202" class="headerpic">
            <a alt="Open Object - Free Management Solution Logo" href="http://openerp.com">
              <img border="0" src="../../_static/openerp.jpg"/>
            </a>
          </td>
         <td width="335" class="headerpic">
            <div align="right"><img src="../../_static/headerpic.jpg" width="242" height="68" /></div>
          </td>
          <td width="440" valign="top" align="right">
            <table id="Table_01" height="37" border="0" cellpadding="0" cellspacing="0">
              <tr>
                <td class="greycurveleft" width="23px" height="37px"></td>
                <td width="107" class="headerlinkgrey">
                  <div class="headerlink" align="center"><a href="http://openerp.com"><strong>OpenERP</strong></a></div>
                </td>
                <td width="22px" height="37px" class="greyredcurve"></td>
                <td width="125" height="37" class="redline">
                  <div class="headerlink" align="center"><a href="http://ondemand.openerp.com"><strong>OnDemand</strong></a></div>
                </td>
                <td width="20" height="37" class="redcurve">&nbsp;</td>
                <td width="139" height="37" class="redline">
                  <div class="headerlink" align="center"><a href="http://openobject.com"><strong>Community</strong></a></div>
                </td>
                <td width="16" height="37"><img src="../../_static/curve.gif"/></td>
              </tr>
            </table>
            <p class="fortune">Best-selling book on enterprise management</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="openobject-navbar">
    <table width="1004" border="0" cellspacing="0" cellpadding="0" id="menu-header">
      <tr>
        <td width="230" id="menu-header" nowrap="nowrap">&nbsp;</td>
        <td id="menu-breadcrumb" nowrap="nowrap">
          
    <div class="related-tiny">
      <h3>Navigation</h3>
      <ul>
        <li class="right">
          <select id="comments_control">
            <option value="">comments control</option>
            <option value="HIDE">hide</option>
            <option value="SHOW">show</option>
          </select>
        </li>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="../3_10_wizard/index.html" title="Creating Wizard - (The Process)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../2_7_menu_action/7_3_security.html" title="Security"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Developer Book</a> &raquo;</li> 
      </ul>
    </div>

        </td>
      </tr>
    </table>
  </div>


      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Workflow-Business Process</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a><ul>
<li><a class="reference external" href="#wkfexample1-discount-on-orders">WkfExample1: Discount On Orders</a></li>
<li><a class="reference external" href="#wkfexample2-a-sale-order-that-generates-an-invoice-and-a-shipping-order">WkfExample2: A sale order that generates an invoice and a shipping order.</a></li>
</ul>
</li>
<li><a class="reference external" href="#defining-workflow">Defining Workflow</a></li>
<li><a class="reference external" href="#general-structure-of-a-workflow-xml-file">General structure of a workflow XML file</a></li>
<li><a class="reference external" href="#activity">Activity</a><ul>
<li><a class="reference external" href="#id1">Introduction</a></li>
<li><a class="reference external" href="#the-fields">The fields</a></li>
<li><a class="reference external" href="#split-mode">split_mode</a></li>
<li><a class="reference external" href="#kind">kind:</a></li>
<li><a class="reference external" href="#action">action:</a></li>
<li><a class="reference external" href="#flow-stop">flow_stop</a></li>
<li><a class="reference external" href="#wkf-id">wkf_id</a></li>
<li><a class="reference external" href="#the-general-structure-of-an-activity-record-is-as-follows">The general structure of an activity record is as follows</a></li>
</ul>
</li>
<li><a class="reference external" href="#transition">Transition</a><ul>
<li><a class="reference external" href="#id2">Introduction</a></li>
</ul>
</li>
<li><a class="reference external" href="#expressions">Expressions</a></li>
<li><a class="reference external" href="#user-role">User Role</a></li>
<li><a class="reference external" href="#error-handling">Error handling</a></li>
<li><a class="reference external" href="#creating-a-workflow">Creating a Workflow</a><ul>
<li><a class="reference external" href="#define-the-states-of-your-object">Define the States of your object</a></li>
<li><a class="reference external" href="#define-the-state-change-handling-methods">Define the State-change Handling Methods</a></li>
<li><a class="reference external" href="#testing">Testing</a></li>
<li><a class="reference external" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../2_7_menu_action/7_3_security.html"
                                  title="previous chapter">Security</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../3_10_wizard/index.html"
                                  title="next chapter">Creating Wizard - (The Process)</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/developer/3_9_Workflow_Business_Process/index.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
<div id="searchbox">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<h3>Open ERP Books</h3><br />
<table cellpading="10px" cellspacing="10px" style="border: 1px solid #98DBCC;" align="center" bgcolor="#FFFFFF">
  <tr>
   <td align="center">
   <span style="text-align:center;">
<iframe src="http://rcm-fr.amazon.fr/e/cm?t=fabsblo-21&o=8&p=8&l=as1&asins=2212122616&fc1=000000&IS2=
1&lt1=_blank&lc1=0000FF&bc1=FFFFFF&bg1=FFFFFF&f=ifr&npa=1" style="width:120px;height:240px;text-align:center;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</span>
   </td>
  </tr>
  <tr> 
  <td align="center">
<a href="http://www.openerp.com/buy.html?page=shop.product_details&amp;flypage=openerp.tpl&amp;product_id=36&amp;category_id=8" title="Open ERP for Retail and Industrial Management" style="border:none;"><img src="http://www.openerp.com/components/com_virtuemart/shop_image/product/Open_ERP_for_Ret_4a1a9e3e3dec5.png" width="100px" height="134px" style="border:none; text-align:center;"></a>
<p style="font-size:10px;">Retail and Industrial Management, steps towards Sales, Logistics and Manufacturing Integration in the Open Source & Management Collection.</p>
</span>
</td>
</tr>
</table>

        </div>
      </div>


    <div class="document">
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="workflow-business-process">
<h1>Workflow-Business Process<a class="headerlink" href="#workflow-business-process" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/developer/3_9_Workflow_Business_Process/index/introduction" ></div><p>The workflow system in Open ERP is a very powerful mechanism that can describe the evolution of documents (model) in time.</p>
<p>Workflows are entirely customizable, they can be adapted to the flows and trade logic of almost any company. The workflow system makes Tiny ERP very flexible and allows it to easily support changing needs without having to program new functionalities.</p>
<p><strong>Goals</strong></p>
<p><strong>To understand its utility, see these three examples:</strong></p>
<div class="section" id="wkfexample1-discount-on-orders">
<h3>WkfExample1: Discount On Orders<a class="headerlink" href="#wkfexample1-discount-on-orders" title="Permalink to this headline">¶</a></h3>
<p>The first diagram represent a very basic workflow of an order:</p>
<img alt="../../_images/Workflow_bc1.png" src="../../_images/Workflow_bc1.png" />
<p>The order starts in the &#8216;draft&#8217; state, when it is in redaction and not approved. When the user press on the &#8216;Confirm&#8217; button, the invoice is created and the order comes into the &#8216;CONFIRMED&#8217; state.</p>
<p>Then, two operations are possible:</p>
<ol class="arabic simple">
<li>the order is done (shipped)</li>
<li>the order is canceled</li>
</ol>
<p>Let&#8217;s suppose a company has a need not implemented in OpenERP. For example, suppose their sales staff can only offer discounts of 15% or less. Every order having a discount above 15% must be approved by the sales manager.</p>
<p>This modification in the sale logic doesn&#8217;t need any line of python code! A simple modification of the workflow allows us to take this new need into account and add the extra validation step.</p>
<img alt="../../_images/Workflow_bc2.png" src="../../_images/Workflow_bc2.png" />
<p>The workflow is thus modified as above and the orders will react as we want to. We then only need to modify the order form view and add a validation button at the desired location.</p>
<p>We could then further improve this workflow by sending a request to the sales manager when an order enters the &#8216;Validation&#8217; state. Workflow nodes can execute object methods; only two lines of Python are needed to send a request asking the sales manager to validate or not the order.</p>
</div>
<div class="section" id="wkfexample2-a-sale-order-that-generates-an-invoice-and-a-shipping-order">
<h3>WkfExample2: A sale order that generates an invoice and a shipping order.<a class="headerlink" href="#wkfexample2-a-sale-order-that-generates-an-invoice-and-a-shipping-order" title="Permalink to this headline">¶</a></h3>
<img alt="../../_images/Workflow_sale.png" src="../../_images/Workflow_sale.png" />
<p>WkfExample3: Acount invoice basic workflow</p>
<img alt="../../_images/Acount_inv_wkf.jpg" src="../../_images/Acount_inv_wkf.jpg" />
</div>
</div>
<div class="section" id="defining-workflow">
<h2>Defining Workflow<a class="headerlink" href="#defining-workflow" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/defining-workflow" ></div><p>Workflows are defined in the file server/bin/addons/base/ir/workflow/workflow.py. The first three classes defined in this file are workflow, wkf_activity and wkf_transition. They correspond to the three types of resources that are necessary to describe a workflow :</p>
</div>
<div class="section" id="general-structure-of-a-workflow-xml-file">
<h2>General structure of a workflow XML file<a class="headerlink" href="#general-structure-of-a-workflow-xml-file" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/general-structure-of-a-workflow-xml-file" ></div><p>The general structure of a workflow XML file is as follows :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;terp&gt;</span>
<span class="nt">&lt;data&gt;</span>
<span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;workflow&quot;</span> <span class="na">id=</span><span class="s">workflow_id</span><span class="nt">&gt;</span>

    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>workflow.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;osv&quot;</span><span class="nt">&gt;</span>resource.model<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;on_create&quot;</span><span class="nt">&gt;</span>True | False<span class="nt">&lt;/field&gt;</span>

<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/terp&gt;</span>
</pre></div>
</div>
<p><strong>Where</strong></p>
<p><strong>Example</strong></p>
<p>The workflow <strong>&#8220;sale.order.basic&#8221;</strong> defined in addons/sale/sale_workflow.xml follows exactly this model, the code of its workflow tag is :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;workflow&quot;</span> <span class="na">id=</span><span class="s">&quot;wkf_sale&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>sale.order.basic<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;osv&quot;</span><span class="nt">&gt;</span>sale.order<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;on_create&quot;</span><span class="nt">&gt;</span>True<span class="nt">&lt;/field&gt;</span>

<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="activity">
<h2>Activity<a class="headerlink" href="#activity" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/activity" ></div><div class="section" id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The wkf_activity class represents the nodes of workflows. These nodes are the actions to be executed.</p>
</div>
<div class="section" id="the-fields">
<h3>The fields<a class="headerlink" href="#the-fields" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="split-mode">
<h3>split_mode<a class="headerlink" href="#split-mode" title="Permalink to this headline">¶</a></h3>
<img alt="../../_images/Wkf_split.png" src="../../_images/Wkf_split.png" />
<ul class="simple">
<li>XOR: One necessary transition, takes the first one found (default).</li>
<li>OR : Take only valid transitions (0 or more) in sequential order.</li>
<li>AND: All valid transitions are launched at the same time (fork).</li>
</ul>
<p>In the OR and AND separation mode, certain workitems can be generated.</p>
<p>In the AND mode, the activity waits for all transitions to be valid, even if some of them are already valid. They are all triggered at the same time.
join_mode
join_mode:</p>
<img alt="../../_images/Wkf_join.png" src="../../_images/Wkf_join.png" />
<ul class="simple">
<li><strong>XOR</strong>: One transition necessary to continue to the destination activity (default).</li>
<li><strong>AND</strong>: Waits for all transition conditions to be valid to execute the destination activity.</li>
</ul>
</div>
<div class="section" id="kind">
<h3>kind:<a class="headerlink" href="#kind" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">The type of the activity can take several values:</th></tr>
<tr><td>&nbsp;</td><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>A sub-workflow is executed when an activity is of the type SUBFLOW. This activity ends when the sub-workflow has finished. While the sub-workflow is active, the workitem of this activity is frozen.</p>
</div>
<div class="section" id="action">
<h3>action:<a class="headerlink" href="#action" title="Permalink to this headline">¶</a></h3>
<p>The action indicates the method to execute when a workitem comes into this activity. The method must be defined in a object which belongs this workflow and have the following signature:</p>
<p>In the action though, they will be called by a statement like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">signal_send</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">flow_start</span>
</pre></div>
</div>
<p>Indicates if the node is a start node. When a new instance of a workflow is created, a workitem is activated for each activity marked as a flow_start.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Be warned to not use this flag unless your activity really is a &#8220;flow
start&#8221;. There are tiny versions that do not care about the tags contents
like &#8220;true&#8221; or &#8220;false&#8221;. Using such tag and tiny version, you will always
end up whith an activity which is tagged as &#8220;flow start = true&#8221;, leaving u
with a nasty hunt to find out where your workflow design could be wrong.</p>
<p class="last">This is because tags content are always evaluated as string. Read the
section about the <a class="reference external" href="../2_6_views_events/views/design_element.html#eval-attribute-link"><em>eval attribute</em></a> for an
explanation.</p>
</div>
</div>
<div class="section" id="flow-stop">
<h3>flow_stop<a class="headerlink" href="#flow-stop" title="Permalink to this headline">¶</a></h3>
<p>Indicates if the node is an ending node. When all the active workitems for a given instance come in the node marked by flow_stop, the workflow is finished.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Be warned to not use this flag unless your activity really is a &#8220;flow
stop&#8221;. There are tiny versions that do not care about the tags contents
like &#8220;true&#8221; or &#8220;false&#8221;. Using such tag and tiny version, you will always
end up whith an activity which is tagged as &#8220;flow stop = true&#8221;, leaving u
with a nasty hunt to find out where your workflow design could be wrong.</p>
<p class="last">This is because tags content are always evaluated as string. Read the
section about the <a class="reference external" href="../2_6_views_events/views/design_element.html#eval-attribute-link"><em>eval attribute</em></a> for an
explanation.</p>
</div>
</div>
<div class="section" id="wkf-id">
<h3>wkf_id<a class="headerlink" href="#wkf-id" title="Permalink to this headline">¶</a></h3>
<p>The workflow which this activity belongs to.
Defining activities using XML files</p>
</div>
<div class="section" id="the-general-structure-of-an-activity-record-is-as-follows">
<h3>The general structure of an activity record is as follows<a class="headerlink" href="#the-general-structure-of-an-activity-record-is-as-follows" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;workflow.activity&quot;</span> <span class="na">id=</span><span class="s">&quot;&#39;&#39;activity_id&#39;&#39;&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;wkf_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;&#39;&#39;workflow_id&#39;&#39;&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>&#39;&#39;activity.name&#39;&#39;<span class="nt">&lt;/field&gt;</span>::

      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;split_mode&quot;</span><span class="nt">&gt;</span>XOR | OR | AND<span class="nt">&lt;/field&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;join_mode&quot;</span><span class="nt">&gt;</span>XOR | AND<span class="nt">&lt;/field&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;kind&quot;</span><span class="nt">&gt;</span>dummy | function | subflow | stopall<span class="nt">&lt;/field&gt;</span>

      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>&#39;&#39;(...)&#39;&#39;<span class="nt">&lt;/field&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;signal_send&quot;</span><span class="nt">&gt;</span>&#39;&#39;(...)&#39;&#39;<span class="nt">&lt;/field&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;flow_start&quot;</span><span class="nt">&gt;</span>True | False<span class="nt">&lt;/field&gt;</span>
      <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;flow_stop&quot;</span><span class="nt">&gt;</span>True | False<span class="nt">&lt;/field&gt;</span>
  <span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p>The first two arguments <strong>wkf_id</strong> and name are mandatory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Be warned to not use <strong>flow_start</strong> and <strong>flow_stop</strong> unless your activity
really is a <strong>flow start</strong> or <strong>flow_stop</strong>. There are tiny versions that
do not care about the tags contents like &#8220;True&#8221; or &#8220;False&#8221;.</p>
<p class="last">This is because tags content are always evaluated as string. Read the
section about the <a class="reference external" href="../2_6_views_events/views/design_element.html#eval-attribute-link"><em>eval attribute</em></a> for an
explanation.</p>
</div>
<p>Examples</p>
<p>There are too many possibilities of activity definition to choose from using this definition. We recommend you to have a look at the file <strong>server/bin/addons/sale/sale_workflow.xml</strong> for several examples of activity definitions.</p>
</div>
</div>
<div class="section" id="transition">
<h2>Transition<a class="headerlink" href="#transition" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/transition" ></div><div class="section" id="id2">
<h3>Introduction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Workflow transitions are the conditions to be satisfied to go from one activity to the next one. They are represented by one-way arrows joining two activities.</p>
<p>The conditions are of different types:</p>
<p>The roles and signals are evaluated before the expression. If a role or a signal is false, the expression will not be evaluated.</p>
<p>Transition tests may not write values in objects.
The fields</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">act_from</span>
</pre></div>
</div>
<p>Source activity. When this activity is over, the condition is tested to determine if we can start the ACT_TO activity.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">act_to</span>
</pre></div>
</div>
<p>The destination activity.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">condition</span>
</pre></div>
</div>
<p><strong>Expression</strong> to be satisfied if we want the transition done.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">signal</span>
</pre></div>
</div>
<p>When the operation of transition comes from a button pressed in the client form, signal tests the name of the pressed button.</p>
<p>If signal is NULL, no button is necessary to validate this transition.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">role_id</span>
</pre></div>
</div>
<p>The <strong>role</strong> that a user must have to validate this transition.
Defining Transitions Using XML Files</p>
<p>The general structure of a transition record is as follows</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;workflow.transition&quot;</span> <span class="na">id=</span><span class="s">&quot;transition_id&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;act_from&quot;</span> <span class="na">ref=</span><span class="s">&quot;activity_id&#39;_1_&#39;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;act_to&quot;</span> <span class="na">ref=</span><span class="s">&quot;activity_id&#39;_2_&#39;&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;signal&quot;</span><span class="nt">&gt;</span>(...)<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;role_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;role_id&#39;_1_&#39;&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;condition&quot;</span><span class="nt">&gt;</span>(...)<span class="nt">&lt;/field&gt;</span>

    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;trigger_model&quot;</span><span class="nt">&gt;</span>(...)<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;trigger_expr_id&quot;</span><span class="nt">&gt;</span>(...)<span class="nt">&lt;/field&gt;</span>

<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p>Only the fields <strong>act_from</strong> and <strong>act_to</strong> are mandatory.</p>
</div>
</div>
<div class="section" id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/expressions" ></div><p>Expressions are written as in python:</p>
<p>Any field from the resource the workflow refers to can be used in these expressions. For example, if you were creating a workflow for partner addresses, you could use expressions like:</p>
</div>
<div class="section" id="user-role">
<h2>User Role<a class="headerlink" href="#user-role" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/user-role" ></div><p>Roles can be attached to transitions. If a role is given for a transition, that transition can only be executed if the user who triggered it possess the necessary role.</p>
<p>Each user can have one or several roles. Roles are defined in a tree of roles, parent roles having the rights of all their children.</p>
<p>Example:</p>
<p>CEO</p>
<p>Let&#8217;s suppose we handle our own bug database and that the action of marking a bug as valid needs the Testers role. In the example tree above, marking a bug as valid could be done by all the users having the following roles: Testers, Lead developper, Technical manager, CEO.</p>
</div>
<div class="section" id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/error-handling" ></div><p>As of this writing, there is no exception handling in workflows.</p>
<p>Workflows being made of several actions executed in batch, they can&#8217;t trigger exceptions. In order to improve the execution efficiency and to release a maximum of locks, workflows commit at the end of each activity. This approach is reasonable because an activity is only started if the conditions of the transactions are satisfied.</p>
<p>The only problem comes from exceptions due to programming errors; in that case, only transactions belonging to the entirely terminated activities are executed. Other transactions are &#8220;rolled back&#8221;.</p>
</div>
<div class="section" id="creating-a-workflow">
<h2>Creating a Workflow<a class="headerlink" href="#creating-a-workflow" title="Permalink to this headline">¶</a></h2>
<div class="js-kit-comments" path="/creating-a-workflow" ></div><p>Steps for creating a simple state-changing workflow for a custom module called <strong>mymod</strong></p>
<div class="section" id="define-the-states-of-your-object">
<h3>Define the States of your object<a class="headerlink" href="#define-the-states-of-your-object" title="Permalink to this headline">¶</a></h3>
<p>The first step is to define the States your object can be in. We do this by adding a &#8216;state&#8217; field to our object, in the _columns collection</p>
<div class="highlight-python"><pre>_columns = {
 ...
    'state': fields.selection([
    ('new','New'),
    ('assigned','Assigned'),
    ('negotiation','Negotiation'),
    ('won','Won'),
    ('lost','Lost')], 'Stage', readonly=True),
}</pre>
</div>
</div>
<div class="section" id="define-the-state-change-handling-methods">
<h3>Define the State-change Handling Methods<a class="headerlink" href="#define-the-state-change-handling-methods" title="Permalink to this headline">¶</a></h3>
<p>Add the following additional methods to your object. These will be called by our workflow buttons</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mymod_new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;state&#39;</span> <span class="p">:</span> <span class="s">&#39;new&#39;</span> <span class="p">})</span>
     <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">mymod_assigned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;state&#39;</span> <span class="p">:</span> <span class="s">&#39;assigned&#39;</span> <span class="p">})</span>
     <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">mymod_negotiation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;state&#39;</span> <span class="p">:</span> <span class="s">&#39;negotiation&#39;</span> <span class="p">})</span>
     <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">mymod_won</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;state&#39;</span> <span class="p">:</span> <span class="s">&#39;won&#39;</span> <span class="p">})</span>
     <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">mymod_lost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">):</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;state&#39;</span> <span class="p">:</span> <span class="s">&#39;lost&#39;</span> <span class="p">})</span>
     <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Obviously you would extend these methods in the future to do something more useful!
Create your Workflow XML file
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</p>
<p>There are three types of records we need to define in a file called mymod_workflow.xml</p>
<ol class="arabic simple">
<li>Workflow header record (only one of these)</li>
</ol>
<ol class="arabic simple">
<li>Workflow Activity records</li>
</ol>
<ol class="arabic simple">
<li>Workflow Transition records</li>
</ol>
<p>Add mymod_workflow.xml to __terp__.py</p>
<p>Edit your module&#8217;s __terp__.py and add mymod_workflow.xml to the &#8220;update_xml&#8221; array, so that OpenERP picks it up next time your module is loaded.
Add Workflow Buttons to your View</p>
<p>The final step is to add the required buttons to mymod_views.xml file.</p>
<p>Add the following at the end of the &lt;form&gt; section of your object&#8217;s view definition:</p>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>Now use the Module Manager to install or update your module. If you have done everything correctly you shouldn&#8217;t get any errors. You can check if your workflow is installed in Administration -&gt; Customisation -&gt; Workflow Definitions</p>
<p>When you are testing, remember that the workflow will only apply to NEW records that you create.</p>
</div>
<div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h3>
<p>If your buttons do not seem to be doing anything, one of the following two things are likely:</p>
</div>
</div>
</div>


            <br />
            <div class="js-kit-comments" permalink=""></div>
            <script src="http://js-kit.com/comments.js"></script>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Workflow-Business Process</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a><ul>
<li><a class="reference external" href="#wkfexample1-discount-on-orders">WkfExample1: Discount On Orders</a></li>
<li><a class="reference external" href="#wkfexample2-a-sale-order-that-generates-an-invoice-and-a-shipping-order">WkfExample2: A sale order that generates an invoice and a shipping order.</a></li>
</ul>
</li>
<li><a class="reference external" href="#defining-workflow">Defining Workflow</a></li>
<li><a class="reference external" href="#general-structure-of-a-workflow-xml-file">General structure of a workflow XML file</a></li>
<li><a class="reference external" href="#activity">Activity</a><ul>
<li><a class="reference external" href="#id1">Introduction</a></li>
<li><a class="reference external" href="#the-fields">The fields</a></li>
<li><a class="reference external" href="#split-mode">split_mode</a></li>
<li><a class="reference external" href="#kind">kind:</a></li>
<li><a class="reference external" href="#action">action:</a></li>
<li><a class="reference external" href="#flow-stop">flow_stop</a></li>
<li><a class="reference external" href="#wkf-id">wkf_id</a></li>
<li><a class="reference external" href="#the-general-structure-of-an-activity-record-is-as-follows">The general structure of an activity record is as follows</a></li>
</ul>
</li>
<li><a class="reference external" href="#transition">Transition</a><ul>
<li><a class="reference external" href="#id2">Introduction</a></li>
</ul>
</li>
<li><a class="reference external" href="#expressions">Expressions</a></li>
<li><a class="reference external" href="#user-role">User Role</a></li>
<li><a class="reference external" href="#error-handling">Error handling</a></li>
<li><a class="reference external" href="#creating-a-workflow">Creating a Workflow</a><ul>
<li><a class="reference external" href="#define-the-states-of-your-object">Define the States of your object</a></li>
<li><a class="reference external" href="#define-the-state-change-handling-methods">Define the State-change Handling Methods</a></li>
<li><a class="reference external" href="#testing">Testing</a></li>
<li><a class="reference external" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../2_7_menu_action/7_3_security.html"
                                  title="previous chapter">Security</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="../3_10_wizard/index.html"
                                  title="next chapter">Creating Wizard - (The Process)</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/developer/3_9_Workflow_Business_Process/index.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
<div id="searchbox">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<h3>Open ERP Books</h3><br />
<table cellpading="10px" cellspacing="10px" style="border: 1px solid #98DBCC;" align="center" bgcolor="#FFFFFF">
  <tr>
   <td align="center">
   <span style="text-align:center;">
<iframe src="http://rcm-fr.amazon.fr/e/cm?t=fabsblo-21&o=8&p=8&l=as1&asins=2212122616&fc1=000000&IS2=
1&lt1=_blank&lc1=0000FF&bc1=FFFFFF&bg1=FFFFFF&f=ifr&npa=1" style="width:120px;height:240px;text-align:center;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</span>
   </td>
  </tr>
  <tr> 
  <td align="center">
<a href="http://www.openerp.com/buy.html?page=shop.product_details&amp;flypage=openerp.tpl&amp;product_id=36&amp;category_id=8" title="Open ERP for Retail and Industrial Management" style="border:none;"><img src="http://www.openerp.com/components/com_virtuemart/shop_image/product/Open_ERP_for_Ret_4a1a9e3e3dec5.png" width="100px" height="134px" style="border:none; text-align:center;"></a>
<p style="font-size:10px;">Retail and Industrial Management, steps towards Sales, Logistics and Manufacturing Integration in the Open Source & Management Collection.</p>
</span>
</td>
</tr>
</table>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../3_10_wizard/index.html" title="Creating Wizard - (The Process)"
             >next</a> |</li>
        <li class="right" >
          <a href="../2_7_menu_action/7_3_security.html" title="Security"
             >previous</a> |</li>

          <li><a href="../index.html" >Developer Book</a> &raquo;</li> 
      </ul>
    </div>


    <div class="related-tiny">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I" class="bottom-nav-links" >index</a></li>
        <li class="right" >
          <a href="../../modindex.html" title="Global Module Index"
             accesskey="M" class="bottom-nav-links" >modules</a> |</li>
        <li class="right" >
          <a href="../3_10_wizard/index.html" title="Creating Wizard - (The Process)"
             accesskey="N" class="bottom-nav-links" >next</a> |</li>
        <li class="right" >
          <a href="../2_7_menu_action/7_3_security.html" title="Security"
             accesskey="P" class="bottom-nav-links" >previous</a> |</li>
        <li><a href="../../index.html">Documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Developer Book</a> &raquo;</li>
        
      </ul>
    </div>

    <div class="footer">
      &copy; <a href="../../copyright.html">Copyright</a> .
      Last updated on 2009-07-16.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
<script type="text/javascript">

var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));

try {
  var pageTracker = _gat._getTracker("UA-7333765-8");
  pageTracker._trackPageview();
} catch(err) {}

</script>

  </body>
</html>