Illustration of stock management
---------------------------------

To illustrate this concept of stock management, see how stock moves are generated by the following operations:

* Receipt from a supplier,

* Delivery to a customer,

* Inventory operation for lost materials,

* Manufacture of a computer.

For this chapter you should start by installing the *stock* module (which also installs a few dependencies with it) into a new minimal database populated with Tiny's demonstration data. You don't need to choose any particular chart of accounts during configuration of the database, but you can if you want to.

The structure of stock locations is shown by the figure above. Stocks are assumed to be totally empty and no operation is in progress nor planned.

If you order '30 Computers' from a supplier, Open ERP will then do the following operations after the receipt of the products:

================================================== =============
Location                                           Products
================================================== =============
Partner Locations > Suppliers > IT Suppliers       -30 Computers
Physical Locations > Tiny SPRL > Stock             +30 Computers
================================================== =============

If you deliver 2 Computers to a European customer you will get the following transastions for the delivery:

================================================== =============
Location                                           Products
================================================== =============
Physical Locations > Tiny SPRL > Stock             -2 Computers
Partner Locations > Customers > European Customers +2 Computers
================================================== =============

When the two operations are complete you'll then get the following stock in each location:

================================================== =============
Location                                           Products
================================================== =============
Partner Locations > Suppliers > IT Suppliers       -30 Computers
Physical Locations > Tiny SPRL > Stock             +28 Computers
Partner Locations > Customers > European Customers +2 Computers
================================================== =============

So you can see that the sum of the stocks of a product in all the locations in Open ERP is always zero. In accounting you'd say that the sum of the debits is equal to the sum of the credits.

Partner locations (customers and suppliers) aren't located beneath your company in the hierarchical structure, so their contents are not considered as part of your own stock. So if you look just at the physical locations inside your own company those two computers are no longer in your company. They're not in your own physical stock but it's still very useful to see them in your customer's stock because that helps when you carry out detailed stock management analysis.

In accounting, all documents lead to accounting entries that form the basis of management accounting. If you create invoices or code in statements of account, for example, the results of the operations are accounting entries on accounts. And it's the same for stock management in Open ERP. All stock operations are carried out as simple stock moves. Whether you pack items, or manufacture them, or carry out a stock inventory operation, stock moves are carried out every time.

You've seen a fairly simple example of goods receipt and product delivery, but some operations are less obvious – a stock inventory operation, for example. An inventory operation is carried out when you compare the stock shown in software with real stock numbers counted in the stores. In traditional software you just change the stock shown in the software to the amount you've just counted so that they match. So you get fewer or more products in the location under consideration.

In Open ERP, with its double-entry stock management, you'd use stock moves for this inventory operation. That helps you manage your stock traceability. If there are 26 Computers in real stock but Open ERP shows 28 in the system. You then have to reduce the number in Open ERP to 26. This reduction of 2 units is considered as a loss or destruction of products and the correction is carried out as in the following operation:

================================================== =============
Location                                           Products
================================================== =============
Physical Locations > Tiny SPRL > Stock             -2 Computers
Virtual Locations > Inventory Loss                 +2 Computers
================================================== =============

The product stock under consideration then becomes:

================================================== =============
Location                                           Products
================================================== =============
Partner Locations > Suppliers > IT Suppliers       -30 Computers
Physical Locations > Tiny SPRL > Stock             +26 Computers
Partner Locations > Customers > European Customers +2 Computers
Virtual Locations > Inventory Loss                 +2 Computers
================================================== =============

Notice the great advantage of this approach in terms of performance analysis. After a few months, you can just make a stock valuation of the location “Virtual Locations > Inventory Loss” to give you the value of the company's stock losses in the given period.

Now see how the following manufacturing operation is structured in Open ERP. To make a bicycle you need two wheels and a frame. This means that there should be a reduction of two wheels and a frame from real stock and the appearance of a bicycle there. The consumption / production is formalized by moving products out of and into physical stock. The stock operations for this are as follows:

====================================== ========== ================================
Location                               Products   Step
====================================== ========== ================================
Virtual Locations > Default Production +2 Wheels  Consumption of raw materials
Physical Locations > Tiny SPRL > Stock -2 Wheels  Consumption of raw materials
Virtual Locations > Default Production +1 Frame   Consumption of raw materials
Physical Locations > Tiny SPRL > Stock -1 Frame   Consumption of raw materials
Virtual Locations > Default Production -1 Bicycle Manufacture of finished products
Physical Locations > Tiny SPRL > Stock +1 Bicycle Manufacture of finished products
====================================== ========== ================================

So you've now got the outcome you need.

.. tip::   **Note**  *Creating value*

    You might already have noticed a useful effect of this approach: if you do a stock valuation in the “Default Production” location you get a statement of value created by your company (as a negative figure). Stock valuation in any given location is calculated by multiplying quantities of products in stock by their cost. In this case the raw material value is deducted from the finished product value.

Advantages of Open ERP's stock management approach
====================================================

Before going any further in discussing the practical application of Open ERP's stock management, review the benefits gained from this approach. 

Stock Management is never correct
----------------------------------

You can have the most organized company in the world, yet you'll quickly find that stock management is never completely correct. If you compare the current stock levels with those shown on your stock management system you'll always find a discrepancy in stock levels that can have a greater or lesser effect on you depending on your company.

That's easy to explain. Manual stock operations quickly result in such discrepancies. It's so easy to forget to code in a goods receipt, or to send too many items to a customer compared with the number specified on the order, or to have thefts or genuinely lost items.

Double-entry stock management gives you very efficient traceability so that you can look for all the stock management errors that you'll get. Classic stock management software gives you the sum of all stock moves for a warehouse and a given product (+3, -2, +5, -1 in this case, giving you a total of +5). In these conditions, with so many stock moves, it's nearly impossible to discover the source of any error.

It's completely different in Open ERP. Double-entry stock management actually gives you two places to look for an error, which significantly improves your chances of finding where errors have occurred. If you forget two stock items the error is automatically reflected in the counterpart location. Such a loss of two items can come from:

* A partner location (forgetting to enter data about a receipt or delivery),

* A production location (too high or low a consumption),

* An inventory location (loss or theft).

Furthermore, you can reconcile it with other Open ERP documents such as sales documents, purchases or production orders, which can help you in your search for problems.

You can compare it with accounts where it's quite straightforward to find errors because you can look for anomolies in accounts or in counterparts. All the time you know that the sum of debits equals the sum of credits.

Stock management must be flexible
----------------------------------

To be efficient, stock management must be as close as possible to reality. But since stock levels aren't possible to predict exactly, it's very important for the stock management system to be flexible. Very few of the available stock management systems provide storespeople and assembly operators with much of the flexibility that they need to manage stocks and production.

Take the case of a new product not yet in stock, and you have forgotten to enter its data when you received it into stores. If he notices it in the set of available products, the storesperson will want to send it to a customer. Few systems can cope with managing this general problem because, if the products haven't been entered into stock then they'll refuse to deliver them. And if the storesperson has actually sent the products on to the customer then such systems won't be able to enter the data about them into the system later. You risk such errors snowballing.

Open ERP's flexibility prevents such a problem. Open ERP supports the concept of negative stock to manage this. The when the storesperson delivers the product to the customer, the stock goes negative because it was never entered at goods in. This poses no problem to Open ERP – the negative value just helps indicate that there's a problem to resolve. Once you've noticed the problem and corrected it by entering the goods-in data the stock returns to its correct level.

This flexibility comes into play whenever it's needed, throughout the most complex operations such as multi-level and lean manufacture. You can always force the system to change the stock values to reflect reality, even in the middle of a complex workflow.

Control of stock management
----------------------------

Stock management must be well controlled to be increasingly effective in meeeting and exceeding company expectations such as improving bottleneck situations, reducing stock quantities, limiting lack of availability, assuring security stocks, and forecasting stock moves.

Double-entry stock management lets you make analyses on several levels. You're not limited to physical stock in your company warehouses, but can also analyze the different virtual locations. All the stock operations in the system can be carried out on both physical and virtual locations such as stock valuation, traceability, historical account valuations, stock forecasts and restocking rules.

Furthermore, the hierarchical location structure enables you to structure both your physical and virtual stocks without limit. For example, you can structure your production locations by product and your partner locations by geography. That gives you all the power of an analytic accounting system applied to stock management.

Stock statistics should be synchronized with stock management
--------------------------------------------------------------

If you have already experienced traditional stock management software you'll already know the problem of getting reliable indicators. If you ask your accountant for a stock valuation or the added value given by production, he'll give you one figure. If you ask the same thing of your stores manager you'll get a rather different figure. It's a terrible situation, because you don't know which figure is more reliable.

Open ERP's stock management is completely integrated with accounts so that both figures are completely synchronized at all times. Stock double entry completely reflects accounting double entry. You can use the system to value stock in real time in your accounts, and this figure will be both up to date and reliable.

Complete traceability
----------------------

The software isn't restricted only to traceability for operations carried out in your warehouse. In certain areas that can pose several problems. For example, in agro-food there are more and more constraints on traceability.

Open ERP enables you to manage not just your own stock but also supplier and customer stocks. Its traceability extends along the whole chain from supplier to customer, not just your warehouse. So you can have products that make the whole circuit from supplier > stock > customer > returned stock.

The figure below shows the traceability for a PC2 computer, which as been assembled in several steps. This figure is based on Open ERP's demonstration data.

    .. image:: images/stock_traceability.png
       :align: center

*Traceability for a computer.*

Complete workflow from supplier to customer
===========================================

Now you'll follow a practical example by adapting stock management operations. In order you'll see:

* defining a product,

* initial setting of inventory,

* receiving products from a supplier,

* delivering to a customer,

* the final state of stock.

Defining a product
-------------------

To start, define the following product:

==================== ======================
Field                Value
==================== ======================
Name                 Central Heating Type 1
Code                 CCT1
Product Type         Stockable
Method of restocking Purchase
==================== ======================

Use the menu *Products > Products*, then click *New* to define a new product. 

    .. image:: images/stock_product.png
       :align: center

*Definition of a new product.*

Three fields are important for stock management when you're configuring a new product:

* Product Type,

* Procure Method,

* Supply Method.

Product Types
--------------

The product type indicates how the product behaves. The three distinct product types are:

Stockable Product: this product is used in stock management and its replenishment is more or less automated as defined by the rules established in the system. Example, a bicycle.

Consumable: handled in stock management, you can receive it, deliver it and make it. But its stock level isn't managed by the system. Open ERP assumes that you've got sufficient levels in stock at all time, so it doesn't restock it automatically. Example, nails.

Services: these aren't stockable products and don't appear in the various stock operations. Example, a consulting service.

Procurement Methods – Make to Stock and Make to Order
------------------------------------------------------

The procurement method shows how the product will be replenished:

* Make to Stock: you manage product stock and deliver to customers from stock. Periodically you restock a significant quantity of each product if its stock is too low. Example, a classic distributor.

* Make to Order: from production or customer orders, the scheduler automatically generates restocking operations linked directly to the current requirements. A customer order 'Make to Order' won't modify stock in the medium term because you restock with the exact amount that was ordered. Example, computers from large suppliers assembled on demand.

You find a mix of these two modes used for the different final and intermediate products in most industries. The procurement method shown on the product form is just a default value, enabling the salesperson to choose the most convenient mode for fulfilling a particular order.

The figures below show the change of stock levels for a product managed Make to Order and one managed Make to Stock. The two figures are taken from Open ERP's *Future Stock Moves* report, available from the product form.

    .. image:: images/stock_from_stock.png
       :align: center

*Change in stock for a product managed as Make to Stock.*

    .. image:: images/stock_from_order.png
       :align: center

*Change in stock for a product managed as Make to Order.*

.. tip::  *Information** *Logistical Methods*

    The *Make to Stock* logistical approach is best for high volumes and when the demand is seasonal or otherwise easy to forecast. The *Make to Order* approach is used for products that are measured, or very costly to stock or have a short re-stocking time.

Supply Methods
---------------

The Supply Method can be set to:

* Produce: when the product or service is supplied from internal resources,

* Buy: when the product is bought from a supplier.

These are just the default settings used by the system during automated replenishment. A product can be both manufactured internally and bought from a supplier at the same time if required.

The three fields (Supply Method, Procurement Method, Product Type) determine the system's behaviour when a product is required. The system will generate different documents depending on the configuration of the three fields when satisfying a demand.

Open ERP manages both stockable products and services. A service bought from a supplier in *Make to Order* mode, will generate a subcontract order from the supplier in question.

The following illustrates the different cases for automatic restocking.

    .. image:: images/stock_flow.png
       :align: center

*Workflow for automatic restocking, depending on the configuration of the product.*

The table below shows all possible cases for the figure.

================== ===================== =====================
Mode of restocking Produce               Purchase
================== ===================== =====================
MTS                Wait for availability Wait for availability
MTO                Production Order      Supplier Order
================== ===================== =====================

table_stock: Showing restocking for a product of type 'restockable' or 'consumable'.

================== ===================== =====================
Mode of restocking Produce               Purchase
================== ===================== =====================
MTS                /                     /
MTO                Create task           Subcontract
================== ===================== =====================

table_service: Showing restocking for a product of type 'service'.

You'll see the automated management processes for restocking in detail further on in this chapter.

Units of Measure
-----------------

Open ERP is completely multi- units of measure. A product can be expressed in several units of measure at once. For example you can buy grain by the tonne and resell it by kg.  You just have to make sure that all the units of measure used for a product are in the same units of measure category.

.. tip:: **Definition** *Categories of units of measure*

    All units of measure in a category are convertible from one unit to another, for any group of products. This conversion is only one of terminology, transferring from one to the other without any cost change or other manipulation.

The table below shows some examples of units of measure and their category. The factor is used to convert from one unit of measure to another as long as they are in the same category.

========= ============ ======
UoM       Category     Factor
========= ============ ======
Kg        Weight            1
Gram      Weight         1000
Tonne     Weight         0.01
Hour      Working time      8
Day       Working time      1
Half-day  Working time      2
Item      Unit              1
100 Items Unit           0.01
========= ============ ======

So you have 1Kg = 1000g = 0.001 Tonnes.

Use the menu *Products > Configuration > Units of Measure > Units of Measure* to define a new unit of measure. In the definition of a Unit of Measure, you have a *Rounding precision* factor which shows how amounts are rounded after the conversion. A value of 1 gives rounding to the level of one unit. 0.01 gives rounding to one hundredth.

.. tip::   **Advice**  *Secondary Units*

    Open ERP supports double units of measure . In this case, the whole of the stock management system is encode in two units that don't have a real link between them. This is very useful in the agro-food industry, for example: you sell ham by the piece but invoice by the Kg. A weighing operation is needed before invoicing the customer.

To activate the management options for double units of measure, assign the group *Useability / Product UoS View* to your user.

In the product form you can then see one unit of measure for sales and stock management, and one unit of measure for purchases. You have to use units that are in the same unit of measure category otherwise you won't be able to convert quantities between the two.

These units are given suggested titles. For each operation on a product you can use another unit of measure, as long as it can be found in the same category as the two units already defined. If you use another unit of measure, Open ERP automatically handles the conversion of prices and quantities.

So if you have 430 Kg of carottes at 5.30 EUR/Kg, Open ERP will automatically make the conversion if you want to sell in tonnes – 0.43 tonnes at 5300 EUR / tonne. If you had set a rounding factor of 0.1 for the *tonne* unit of measure then Open ERP will tell you that you have only 0.4 tonnes available.

Stocks
=======

In the product form you can find a report that will give you the stock levels of the various different products in any selected location. If you haven't selected any location, Open ERP calculates stocks for all of the physical locations.

.. tip::   Availability of stock

    Depending on whether you look at the product from a customer order or from the menu of a product form you can get different values for stock availability. If you use the product menu you get the stock in all of the physical stock locations. If you get to the product from an order you will only see the report of the warehouse selected in the order.

The different fields are:

* Real stock: physical quantity present in your warehouse,

* Incoming stock: forecast incoming quantity from sources such as supplier orders and current production,

* Outgoing stock: forecast outgoing quantity to destinations such as customer deliveries and consumption by current production,

* Virtual stock: calculated this way: real stock – outgoing + incoming.

.. tip::   **Point**  *Virtual Stock*

    Virtual stock is very useful because it shows what the salespeople can sell. If it's more than real stock it's because products are coming in and if it's smaller than reasl stock then it's because products are reserved for other orders.

.. tip::   **Point**  *Detail of future stock*

    To seem more detail about future stock, you can use the report to the right of the product form 'Forecast of Future Stock'. Open ERP shows a graph of the change of stock in the days to come, varying as a function of confirmed orders.

    .. image:: images/stock_forecast.png
       :align: center

*Printout of provisional stock.*

Lead times and locations
-------------------------

The tab *Procurement and Locations* contains information about different lead times and locations. Three lead time figures are available:

* Customer Lead Time: lead time promised to the customer, expressed in number of days between the order and the deliver to the customer,

* Manufacturing Lead Time: lead time, in days, between a production order and the end of production of the finished product,

* Warranty: length of time in months for the warranty for the delivered products.

.. tip::   **More information**  *Warranty*

    The warranty will be used in the management of reparis and after-sales service. You will find more information on this subject in the chapter about manufacturing.

Fields in the section *Storage localisation* are given for information – they don't have any impact on the management of stock.

The counterpart locations are automatically proposed by the system but the different values can be modified. You'll find counterpart locations for:

* Production,

* Inventory,

* Procurement.

A procurement location is a temporary location for stock moves that haven't yet been finalized by the scheduler. When the system doesn't yet know if procurement is to be done by a purchase or production, Open ERP uses the counterpart location *Procurement*. You'll find there everything that hasn't yet been planned by the system. This location shows quantities of zero after each scheduling run.

Initial Inventory
-----------------

Once a product has been defined, use an initial inventory operation to put actual current quantities into the system by location for the products in stock. Use the menu *Stock Management > Periodical Inventory > New Periodical Inventory* for this.

    .. image:: images/stock_inventory_new.png
       :align: center

*Defining a new inventory operation.*

Give a name (for example 'Initial Inventory' or 'Lost Product XYZ') and a date for each inventory operation. You can then enter data about the quantities available for each product by location. Start by showing the location, for example 'Stock', and then select the product. Once the product has been selected, Open ERP automatically completes the actual quantity that it thinks is available for that product in the location shown. You can then change that value to correct the value in stock.

Enter data for a single line in your inventory:

* Location: Stock,

* Product: PC1 Computers,

* Quantity: 23 Units.

.. tip::   **Point**  *Inventory Turns*

    You are usually legally required to do a stock check of all your products at least once a year. As well as doing a complete annual stock check, Open ERP also supports the method of periodical inventory. That means you can check the stock levels of a proportion of your products every so often. This system is accepted in France as long as you can guarantee that all of your products have been counted at least once per year. To do this, use the report *Stock Management > Reporting > Dates of Inventories*.

    This gives you the last inventory date by product.

    You can do this the same way for all products and all locations, so you only carry out small inventory operations through the year rather than a single large stock check at one point in the year (which usually turns out to be at an inconvenient time).

When your inventory operation is finished you can confirm it using the button to the bottom right of the form. Open ERP will then automatically create the stock moves to close the gaps, as mentioned at the start of this chapter. You can verify the moves generated using the second tab of the inventory operation form.

The correct levels of your product are now in your stock locations. A simple way of verifying this is to reopen the product form to see the quantities available in stock.

Reception of a supplier order
------------------------------

Supplier goods receipt forms are automatically prepared by Open ERP by the purchase management process. You'll find a list of all the awaited receipts in the menu *Stock Management > Incoming Goods > Items to be Processed*. Use the order number or the supplier name to find the right goods receipt form for confirmation of a goods in.

    .. image:: images/stock_picking_in_tree.png
       :align: center

*List of items waiting.*

You can also do goods in data entry manually if there's no order, using the menu *Stock Management > Incoming Goods > Items to be Processed* followed by a click on *New*.

A new goods-in data entry form then opens. Enter the supplier data in the partner field and in the field 'Origin' you can type in the reference number from your supplier. You should then enter data about the products received in lines.

The source location is already completed by default because of your supplier selection. You should then give the destination location where you will place the products. For example, enter 'Stock'. At this stage you can set a lot number for traceability (this function will be described later in this chapter, so leave this field empty for the moment).

Then enter data for the receipt of 30 computers of type PC1. Once the first part of the form has been completed you can confirm the receipt of all the products at the same time using the *Process Now* button. If you want to enter data for a receipt that you're still waiting for click the button *Process Later* .

    .. image:: images/stock_picking_in_form.png
       :align: center

*Form for coding in reception of goods from a supplier order.*

When products have finally arrived in your stock you can verify that using the quantities shown on the product form.

In the goods receipt form, there is a field 'Invoicing Control'. If this is set to 'To be invoiced' a supplier invoice will now be generated automatically in the draft state, based on the goods received. Your accountant then has to confirm this pre-invoicing once the supplier's invoice is received. This enables you to verify that the invoiced quantities correspond to the quantities received.

Customer delivery
------------------

Everything about goods receipt is also possible to do manually for a customer delivery. But this time, use the automated product delivery processes based on customer orders. Install the *sale* module so that you can proceed further in this section of the chapter.

Now create a new customer order from the menu *Sales Management > Sales Orders > New Quotation*. Enter the following data in this order:

* Shop: Tiny SPRL

* Customer: Agrolait

* Order Line:

  * Product: PC1 Computer,

  * Quantity: 3 PCE

  * Procurement Method: from stock.

You've seen already that Open ERP shows you the available product stock when you've selected list mode. The real stock is equal to the virtual stock because you've nothing to deliver to customers and you're not waiting for any of these products to be received into stock. The salesperson then has all the information needed to take orders efficiently.

    .. image:: images/stock_sale_form.png
       :align: center

*Encoding an order for three computers.*

Then confirm the quotation to convert it to an order. If you return to the product form you'll see the virtual stock is now smaller than the real stock. That happens because three products have been reserved by the order that you created, so they can't be sold to another customer.

Start the scheduler through the menu *Manufacturing > Compute All Schedulers*. Its functionality will be detailed in the chapter about Manufacturing. All that needs to be said at this stage is that it will manage the reservation of products and place orders based on the dates promised to customers, and the various internal lead times and priorities.

.. tip::  **Point** *Just in Time*

    You can install the module mrp_jit to plan each order in real time after it's been confirmed. This means that you don't have to start the scheduler or wait for its periodical start time.

You can now look at the the list of deliveries waiting to be carried out using the menu *Stock Management > Outgoing Products > Available Packings*. You should find a line there for your order representing the items to be sent. Double-click the line to see the detail of the items proposed by Open ERP.

    .. image:: images/stock_picking_out_form.png
       :align: center

*Items for a customer order.*

.. tip::   **More information**  *States*

    Open ERP distinguishes between the states *confirmed* and *assigned*. You say that an item is confirmed when it's known to be needed but not yet capable of being supplied, generally because the required products aren't available in stock.

    You say that an item is assigned when the storesperson reserves it. The necessary products have been reserved for this specific operation.

You can confirm a customer delivery using the 'Confirm' button. A window then opens where you can enter the quantities actually delivered. If you enter a value less than the forecast one, Open ERP automatically generates a partial delivery notes and a new order for the remaining items. For this exercise, just confirm the whole order.

If you return to the list of current orders you will see that your order has now been marked as delivered (done). A progress indicator from 0% to 100% is shown by each order so that the salesperson can follow the progress of their orders.

    .. image:: images/stock_sale_tree.png
       :align: center

*List of orders with their delivery state.*


Stock analysis
---------------

Now look at the effect of these operations on stock management. There are several ways of viewing stocks:

* from the product form,

* from the locations,

* from the orders.

Start by opening the product form from the menu *Products > Products* and looking at the list of items. You'll immediately see the following information about the products:

* Real Stock,

* Virtual Stock.

If you want more information you can use the actions to the right of the form. If you click the report *Future Stock Forecast*, Open ERP opens a graphical view of the stock levels for the selected products changing with time over the days and weeks to come. The value at the left of the graph is the real stock (today) and the value at the right is the virtual stock (stock in the short term future).

To get the stock levels by location use the button *Stock by Location*.  Open ERP then gives you the stock of this product split out over all the possible locations. If you only want to see the physical locations in your company just filter this list using the Location Type *Internal Locations*. By default, physical locatiosn are already coloured red to distinguish them better. Consolidate locations (the sum of several locations, following the hierarchical structure) are coloured blue.

    .. image:: images/stock_location_product_tree.png
       :align: center

*Stock quantities by location for a given product.*

You can get more detail about all the stock moves from the product form. You'll then see each move from a source location to a destination location. Everything that influences stock levels corresponds to a stock move.

You could also look at the stocks available in a location using the menu *Stock Management > Stock Locations Structure*. You can then use the structure shortcuts at the and the location tree in the main window. Click a location to look at the stocks by product. A location containing child locations shows the consolidated contents for all of its child locations.

You should now check the product quantities for various locations to familiarize yourself with this double-entry stock management system. You should look at:

* supplier locations to see how goods receipts are linked,

* customer locations to see how packing notes are linked,

* inventory locations to see the accumulated losses and profits,

* production locatiosn to see the value created for the company.

Also look at how the real and virtual stocks depend on the location selected. If you enter a supplier location:

* the real stock shows all of the product receipts coming from this type of supplier,

* the virtual stock takes into account the quantities expected from these suppliers(+ real stock + quantities expected from these suppliers). It's the same scheme for customer locations and production locations.

Logistics Configuration
========================

In this section you'll see how to configure stock management to match your company's needs. Open ERP can handle many different situations by configuring it to behave as needed. 

Stock locations
---------------

You've seen in the preceding sections that the whole of stock management is built on a concept of stock locations. Locations are structured hierarchically to account for the subdivision of a warehouse into sections, aisles, and/or cupboards. The hierarchical view also enables you to structure virtual locations such as production counterparts. That gives you a finer level of analysis. 

Use the menu *Stock Management > Configuration > Locations* then click *New* to define new locations.

    .. image:: images/stock_location_form.png
       :align: center

*Definition of a stock location.*

You should then give a name to your stock location. Now look at location types and localization.

Location types
--------------------

The location must have one of the following types:

* View: shows that the location is only an organizational node for the hierarchical structure, and can't be involved in stock moves itself. The view type is not usually made into a leaf node in a structure – it usually has children.

* Customer: destination for products sent to customers,

* Supplier: source of products received from suppliers,

* Internal: locations for your own stock,

* Inventory: the counterpart for inventory operations used to correct stock levels,

* Production: the counterpart for production operations; receipt of raw material and sending finished products,

* Procurement: the counterpart for procurement operations when you don't yet know the source (supplier or production). Products in this location should be zero after the scheduler run completes.

You can have several locations of the same type. In that case your product, supplier and warehouse configurations determine the location that's to be used for any given operation.

The counterparts for procurement, inventory and production operations are given by the locations shown on the product form. The counterparts of reception and delivery operations are given by the locations shown on the partner form. The choice of stock location is given by the configuration of the warehouse, linked to a Shop.

    .. image:: images/stock_product_location_form.png
       :align: center

*Definition of stock locations on the product form.*

    .. image:: images/stock_partner_location_form.png
       :align: center

*Definition of stock locations on the partner form.*

Localization
------------

Each location can be given an address. That enables you to create a location for a customer or a supplier, for example. You can then give it the address of that customer or supplier. You should indicate to Open ERP on the partner form that it should use this location rather than the default location given to partner deliveries.

.. tip::   **Point**  *Subcontracting production*

    You'll see in the chapter about Manufacturing that it is possible to assign a location to a manufacturing workcenter. If this lcoation is at a supplier's you must give it an address so that Open ERP can prepare a delivery order for the supplier and a receive operation for the manufactured goods.

    Creating a location specifically for a partner is also a simple solution for handled consigned stocks in Open ERP.

.. tip:  **Definition** *Consigned Stock*

    Consigned stock is stock that is owned by you (valued in your accounts) but is physically stocked by your supplier. Or, conversely, it could be stock owned by your customer (not valued by you) but stocked in your company.

To enable you to consolidate easily at a higher level, the location definition is hierarchical. This structure is given by the field *Parent location*. That also enables you to manage complex cases of product localization. For example, you could imagine the following scenario.

Example Structure for two warehouses

A company has a warehouse in Paris and in Bordeaux. For some orders you must deliver the products from Paris, and for others from Bordeaux. But you should also specify a fictitious warehouse that Open ERP uses to calculate if it should deliver products from Paris or from Bordeaux.

To do this in Open ERP, you'd create a third warehouse 'France' which consolidates the warehouses in Paris and Bordeaux. You create the following physical locations:

Company
  Output
    Warehouses France
      Warehouse Paris
      Warehouse Bordeaux

Open ERP will then deliver the goods from the warehouse that has the ordered product in stock. When products are available in several warehouses, Open ERP will select the nearest warehouse. To formalize the notion of distance between warehouses you should use the geographic co-ordinates (X, Y, Z) of the different stores to enable Open ERP to search for the nearest goods.

The same co-ordinates could also be used to structure the shelves, aisles and interior rooms in a warehouse.

Accounting valuation in real time
----------------------------------

Open ERP can hold the value of your stock in real time in your accounts. Each stock move will then generate corresponding accounting entries in an accounting journal so that the two systems are permanently synchronized.

To do that, set up a general account for each location which must be valued in accounting. If a product goes to one location or another and the accounts are different in the two locations, Open ERP automatically generates the corresponding accounting entries in the accounts, in the stock journal.

If a stock move will go from a location without an account to a location where an account has been assigned (for example goods receipt from a supplier order), Open ERP generates an accounting entry using the properties defined in the product form for the counterpart. 

You use this system for managing consigned stocks:

* supplier location that is valued in your own accounts or,

* location in your own company that isn't valued in your accounts.

Linked locations
-----------------

Locations in Open ERP can be linked between themselves to define paths followed by products. So you can then define rules such as: all products that enter the warehouse must automatically be sent to quality control. The warehouse and quality control are represented by two different locations.

Then when a product arrives in a location, Open ERP can automatically suggest that you send the product to another linked location. Three link modes are available:

* Manual,

* Automatic,

* Automatic without steps.

The manual mode will create an internal move order to the linked location once products arrive in the source locations. This order will wait for a confirmation of the move by a user. This enables you to have a list of moves to do, proposed by the system and confirmed by the storesperson.

.. tip::   **Point**  *Logistic by Product*

    The module *stock_location* enables you to generate paths to follow, not just a the level of locations but also at the level of products. It then enables you to manage default locations for a given product or to refer the products as a function of operations such as quality control, supplier receipt, and after-sales service.

    It also lets you generate a product chain for a given product and giving a path amongst different locations representing the workcenters.

The automatic mode will do the same but won't wait for a confirmation from the user. Products will automatically be sent to the linked location without any intervening manual operation to do. This corresponds to the case where, for simplicity, you delete a step in the process so the end user can set off the process automatically.

The *automatic without steps* mode won't include the additional stock move but will change the destination move transparently to assign the linked the location. You could then assign a destination location to which you send all the products that arrive in your warehouse. This step is automatic, so that a storesperson will directly see where to put the products at the goods in stage.

If there is a linkage to do, the field 'Type of linked location' lets the destination location be determined. If the field is set to 'customer', the location is given by the properties of the partner form. If the field is set to 'fixed', the destination location is given by the field 'location if link is fixed'.

Some operations have a lead time between order and execution. To account for this lead time, you can set a figure in days in the field 'link lead time'. Then the extra move (automatic or not) will be carried out several days after the original move. If you use the mode 'automatic without step', the lead time is inserted directly into the initial order. In this way you can add security lead times at certain control points in the warehouse.

Case of structuring locations
------------------------------

You'll see in the next part that linking locations lets you manage a whole series of complex cases in manageing production efficiently:

* handling multiple operations for a customer order,

* tracking import and export by sea transport,

* manging a production chain in detail,

* managing rented products, 

* managing consigned products.

To show these concepts, five cases of structuring and configuring these locations are given below. Many other configurations are possible depending on needs.

Handling customer orders
-------------------------

Customer orders are usually handled in one of two ways:

* item note (or preparation order), confirmed when the item is done,

* delivery order (or delivery note), confirmed when the transporter has delivered the item to a customer.

You use the following stock move in Open ERP to simulate these operations:

* Packing Note: Stock > Output,

* Delivery Order: Output > Customer.

The first operation is automatically generated by the customer order. The second is then generated by the stock management by showing that the 'Output' location is linked to the 'Customer' location. That then gives the two operations waiting. If the 'Output' location isn't situated beneath the stock location you then have to move the item from stock to the place that the item is prepared.

Some companies don't want to work in two steps, because it just seems like extra work to have to confirm a delivery note in the system. You can then set the link mode to 'Automatic' to make Open ERP automatically confirm the second step. It's then assumed the all the items have automatically been delivered to the customer.

Linked Production
------------------

The *stock_location* module enables you to manage the linkages by product in addition to doing that by location. You can then create a location structure that represents your production chain by product.

You could then have a location structure like this:

Stock

  Level 1

  Level 2

    Link 1

      Operation 1

      Operation 2

      Operation 3

      Operation 4

You can then set the locations a product or a routing must go through on the relevant form. All products that enter the production chain will automatically follow the predetermined path.

    .. image:: images/stock_product_path.png
       :align: center

*Logistics for a given product.*

To improve your logistics, you'll see further on in this chapter how you can put minimum stock rules onto different locations to guarantee security stocks for assembly operators. Reports on the state of stocks in different locations will rapidly show you the bottlenecks in your production chain.

Import / Export
================

Managing import / export with foreign companies can sometimes be very complex. Between a departure port and destination company, products can get stopped for several months at sea or somewhere in the numerous transportation stages and customs. If you have to manage numerous deliveries you must be able to handle this in the most efficient way you can. So it's important to:

* know where your products are,

* know when they're likely to arrive at their destination,

* know your value in transit,

* follow the development of the different steps.

Linked locations in Open ERP enable this all to be managed rather elegantly. You can use a structure like this:

Suppliers

  European Suppliers

  Chinese Suppliers

In transit

  Shanghai Port

  Pacific Ocean

  San Francisco Port

  San Francisco Customs

Stock
------

The transit location are linked between themselves with a manual confirmation step. When you receive notification that goods have been received at a port or in customs you just need to make the required internal stock move, entering data with the references you've been sent to confirm it all. Open ERP prepares all the linked moves automatically.

.. tip::  **More information** *Intrastat*

    If you do import / export you should install the module *report_intrastat*. This will enable you to prepare the reports needed to declare product exports.

You can use the lead times between different locations to account for real delays.    Your lead times and stock forecasts are calculated by Open ERP to estimate the arrival of incoming products so that you can respond to a customer's needs as precisely as possible.

You can also value the products in transit in your account depending on the chosen stock location configuration.

Rental locations
-----------------

You can manage rental locations in Open ERP very simply using the same system of linked locations. Using the module *stock_location* you can set a return date for rental items sent to customer location after a certain rental period.

Then the set of real and virtual stocks is maintained daily in real time. The different operations such as delivery and receipt after a few days are automatically suggested by Open ERP which simplifies the work of data entry.

You then have the product list found in the customer locations and your own stock in your stock location. The list of goods receipts waiting is automatically generated by Open ERP using the location links.

The same principle is used for internal stock to generate the quality control for certain products.

Consigned Products
-------------------

You can also use the principle of linked locations to manage consigned products. You can indicate that certain products should be returned to you after a certain number of days when they have been delivered to customers.

When the products have been delivered Open ERP automatically creates goods receipts for the consigned product. The indicated date is obviously approximate but enables you to forecast returns fairly efficiently.

Warehouses
===========

Warehouses are designed for physical locations from which you can deliver to the customer and to which you receive raw materials. Then when you buy products from a supplier you should take account of which Warehouse you use for this purchase. This also enables the end user to not have to choose from a list of locations but simply a real warehouses.

Use the menu *Stock Management > Configuration > Warehouses* then click *New* to configure a new warehouse.

A warehouse is defined by a link between three locations:

* The stock location shows the availability of products that you can deliver to a customer direct from this warehouse. Availability is given by all the products in that location and any child locations.

* The entry location shows where ordered products are received from a supplier to that warehouse. It can be the same as the stock location if, for example, you want to do a quality control operation on your incoming raw materials.

* The outgoing location is designed as a buffer zone in which you store all the items that are to be delivered to a customer. You're strongly advised not to put this location within the stock hierarchy but instead at a level higher or the same. 

    .. image:: images/stock_warehouse.png
       :align: center

*Warehouse parameters.*

You can also set an address for the warehouse. This address should ideally be an address for your company. Once the warehouse has been defined it can be used in:

* Minimum stock rules,

* Supplier orders,

* customer orders (using the definition of a point of sale).

Automatic procurement
------------------------

Several methods of automatically procuring products can be carried out by Open ERP:

* the workflow used by products that have the procurement mode *Make to Order*,

* Using minimum stock rules,

* using the master production plan.

The two last methods are described below.

Minimum stock rules
--------------------

To automatically make stock replenishment proposals, you can use minimum stock rules. To do this use the menu *Stock Management > Automatic Procurements > Minimum Stock Rules*. You can then enter rules for product restocking if the level falls below a minimum limit for a specific location.

The rule is the following: if the virtual stock for the given is lower than the minimum stock indicated in the rule, the system will automatically propose a replenishment to increase the level of virtual stock to the maximum level given in the rule.

    .. image:: images/stock_min_rule.png
       :align: center

*List of minimum stock rules.*

.. tip::   **Point**  *Conflict resolution*

You may find that draft production or procurement orders are incorrect after the scheduler has been run. That can happen if the system is badly configured (for example if you've forgotten to set the supplier on a product).

To check this, look at the list of procurements in the exception state in the menu *Stock Management > Automatic Procurements > Procurement Exceptions*. More detail on handling these exceptions is given in the chapter on Manufacturing.

It's important to underline that the rule is based on virtual quantities and not just on real quantities. It then takes account of the calculation of orders and receipts to come.

Take the following example:

* Products in stock: 15

* Products ordered but not delivered: 5

* Products in manfacture: 2

The rules defined are:

Minimum stock: 13

Maximum stock: 25.

Once the requirement are calculated, the rule will regenerate a restocking order (for 15 – 5 + 2 < 13) for a quantity of 13 pirce (= 25 – 15 – 2 + 5).

Note that the restocking doesn't require that you buy from a supplier. If the product has a restocking method of 'to manufacture' the scheduler will generate a production order and not a supplier order.

You can also set multiple quantities in the minimum stock rules. If you set a multiple quantity of 3 the system will propose a restocking of 15 pieces not the 13 it really needs. In this case it automatically rounds the quantity upwards.

Once the rules have been properly configured the purchasing manager only needs to look at the list of orders for confirmation with the supplier using the menu *Purchase Management > Purchase Orders > Requests for Quotation*. He should then confirm them one by one starting with the most urgent at the top of the list.

In a minimum stock rule, when you indicate a warehouse it suggest a stock location by default in that warehouse. You can change that location by default when the scheduler completes, by location and not by warehouse.

Master Production Schedule
===========================

The master production plan, sometimes called the MPS (Master Production Schedule), will enable you to generate forecasts for incoming and outgoing material for a given product in the future. It's based on forecasts of inputs and outputs by the logistics manager. This could also be base on sales forecasts from the different salespeople.

.. tip::   **Point**  *Product trading*

    Also called the Production Plan, this tools is also very useful for traded product which aren't manufactured. You can then use it for stock management with purchased and manufactured products.

To be able to use the production plan, you must install the *stock_planning* module which can be found amongst Open ERP's extra_addons rather in the main set of addons.

Sales Forecasts
----------------

The first things to do to work with a production plan is to define the periods for stock management. Some companies plan daily, others weekly or monthly.

.. tip::   **Point**  *Stock Management interval*

The interval chosen for managing stock in the production plan will depend on the length of your production cycle. You generally work daily, weekly or monthly.

If your products take several days to assemble it's preferable to have a weekly plan. If your manufacturing cycles are several months you can work with a monthly plan.

To do this use the menu *Sales Management > Configuration > Create Sales Periods*. A window appears enabling you to automatically define the next periods that will be provided for stock management.

    .. image:: images/sale_period.png
       :align: center

*Defining periods for stock management.*

Salespeople can then enter their sales forecasts by product and by period using the menu *Sales Management > Sales Forecasts > My Sales Forecasts*. The forecasts can be made by quantity or by value. If you enter a forecast by amount Open ERP automatically calculates for you the quantity equivalent to the estimated amout. This can finally be modified manually ....
    .. image:: images/stock_sale_forecast.png
       :align: center

*Sales Forecast to help create a master production plan.*

Production Plan
----------------

The logistics management can then plan incomings (manufacturing or purchases) and outgoings (consumption or customer deliveries) by period. To do this use the menu *Stock Management > Planning > Master Production Schedule*.

For each period and product Open ERP gives you the following information:

* stock estimated at the end of the period, calculated as stock in the following period less total estimated outgoings plus total estimated inputs,

* closed entries, coming from planned production or purchases,

* forecast inputs for the period, calculated using the incoming entries less the closing amounts,

* planned inputs entered manually by the logistics manager,

* closed outgoings which are the consumption of manufacturing waiting and deliveries to be made to customers,

* forecast outgoings, calculated from the planned outgoings, less the closing amounts,

* planned outgoings, manually entered by the logistics manager,

* sales forecasts, which represent the sum of forecasts made by the salespeople.

    .. image:: images/stock_forecast.png
       :align: center

*The master production schedule (MPS).*

The production plan then enables the logistics manager to play with the forecast income and outgoings and test the impact on the future stock for the product under consideration. It enables you for example to check that the stock doesn't fall below a certain level for the product under consideration.

You can also open the production plan for past periods. In this case Open ERP shows you the real stock moves, by period for incoming and outgoings by forecast reports. This enables you to improve your estimates each time.

If you don't have automated restocking rules for a product you can at any time start a restocking based on the estimates of the production plan. To do this press the button 'Start restocking'. Open ERP manages the forecast of restocking for an amount equal to the entries 'forecast'.

Management of lots and traceability
====================================

The double-entry management in Open ERP enables you to run very advanced traceability. All operations are formalized in terms of stock moves, so it's very simple to search for the cause of a gap in the whole stock moves.

.. tip::   **Definition** *Upstream and downstream traceability*

    Upstream traceability runs from the raw materials received from the supplier and follows the chain to the finished products delivered to customers.

    Downstream traceability follows the product in the other direction, from customer to the different suppliers of raw material.

Stock Moves
------------

To look at the history of transactions about a product or a given location, use the menu: Stock Management > Traceability > Low Level > Stock Moves. All the operations are then available. You can filter on the various field to retrieve the operations about an order, or a production, or a source location, or any given destination.

    .. image:: images/stock_move_tree.png
       :align: center

*History of stock movements.*

Each stock move is in a given state. The different possible states are:

* Draft: the move has so far had no effect in the system. The transaction hasn't yet been confirmed,

* Confirmed: the move will be done, so it will be counted in the calculations of virtual stock. But you don't know whether it will be done without problem because the products have been reserved for the move,

* Validated: the move will be done and the necessary raw material have been reserved for the transaction,

* Done: the stock move has been done, and entered into the calculations of real stock,

* Waiting: in the case of transactions 'From Order', this state shows that the stock move is blocked waiting for the end of another move,

* Cancelled: the stock move wasn't carried out, so there's no account in either real stock or virtual stock.

Delivery orders, goods receipts and internal picking lists are just documents that regroup a set of stock moves. You can also consult the history of these documents using the menu Stock Management > Traceability > Low level > Picking.

Lots
-----

Open ERP is also capable of managing product lots. Two lot types can be distinguished:

* Manufacturing lots (batch numbers) are represented by a unique product or an assembly of identical products leaving the same production. They are usually identified by bar codes stuck on the products. The batch can be identied for your supplier or your company.

* Tracking numbers are logistical lots by which you can identify the container for a set of products. This corresponds, for example, to the pallet numbers on which you can have several different products.

These lots can be encoded on all stock moves and, more precisely, on goods-in lines, internal moves and product deliveries.

    .. image:: images/picking_form_line.png
       :align: center

*Encoding of a line for production reception.*

To enter the lot number in an operation you can use an existing lot number or create a new lot. A manufacturing lot (batch number) must always be used for a single product. A tracking number can be used several times for different products so you can mix different products on a pallet or in a box.

.. tip::   **Point**  *Simplified View*

    If you work with the simplified view you won't see the tracking numbers. The different fields are deliverately hidden in the simplified view.

On the product form it is also possible to indicate the operations in which a lot nubmer is required. You can then force the user to show the lot number for manufacturing operations, goods receipt, or customer packing.

You'll sometimes want to assign a unique lot number to a set of several items. You don't have to encode the lot number one by one to do this. You only need to take a stock move for several products line and click the button *Split move lines in two*. You can then give a lot number prefix and Open ERP will complete the prefix in the wizard with a sequence number using preset parameters.

    .. image:: images/picking_split_lot.png
       :align: center

*Splitting a lot into uniquely identified parts.*

Traceability
-------------

If you encode the lot numbers for stock moves you can then enquire about the traceability for a given lot number. To do this use the menu *Stock Management > Traceability > Production Lots*, or *Stock Management > Traceability > Tracking Lots*.

.. tip::   **Point**  *Product Shortcuts*

    From the product form you have quick access to a lot of useful information from the shortcut bar to the right:

    * Minimum stock rules,

    * Stocks by location,

    * Sales detail,

    * Stocks by lot,



    * Bills of Materials.

Search for the expected lot using the filters for the lot number, the date or the product. Once you can see the form about this lot you can use the actions in the toolbar to the right:

* Traceability upstream: from supplier to customers,

* Traceability downstream: from customer to suppliers,

* Stock spread amongst all the physical and virtual locations.

    .. image:: images/stock_traceability_upstream.png
       :align: center

*Tracing upstream in 'From Order'.*

    .. image:: images/stock_traceability_downstream.png
       :align: center

*Tracing downstream in 'From Stock'.*

The tree given by the traceability view differs depending on whether the stock moves are linked 'From Order' or managed by 'From Stock'. If the operations are linked you will get back a hierarchical structure of stock moves. If the operations are from stock the different lines will be given one after another. 

Finally you can enter data on a production batch about all the the operations that have been done on the product. That forms a useful history of the presales operations.

Management by Journal
======================

Just as with accounting you can manage stock through journals. This approach has the great advantage of being able to define journals in various ways at will as your company's needs change.

For example, a large company may want to organize deliveries by department or warehouse. You can then create a journal and a manager for each department. The different users can then work in a journal as a function of their position in the company. That enables you to structure your information better.

A company that does a lot of transport can organize its journals by delivery vehicle. The different delivery orders will then be assigned to a journal representing a particular vehicle. Then if the vehicle has left the company you can confirm all the orders that are found in the journal all at the same time.

The different journals
-----------------------

Install the module *sale_journal* to work with journals. This adds three new concepts to Open ERP:

* Invoicing journals,

* Order journals,

* Delivery journals.

Invoicing journals will help you assign purchase orders and/or delivery order to a given invoicing journal. It will then be possible to invoice everything in the journal in one go, and to control the different amounts by journal. For example you can create the following journals: daily invoicing, end-of-week invoicing, and end-of-month invoicing. It's also possible to show the invoicing journal by default in the partner form. That enables you to show for a given customer if he is to be invoiced daily or monthly.

Order journals are shown on the orders and are automatically transferred to orders for the corresponding items. These enable you to classify the orders in various ways, such as by department, by salesperson, or by type. Then if a salesperson looks at her own journals after an order she can easily see the work on current items compared with her own orders.

.. tip::  **Point**  *Default Values*

If a salesperson wants to encode all orders in his own order journal he can use the default value in which the cal

Finally the delivery journals are used to post each item into a delivery journal. For example you can create journals dated according to customer delivery dates (such as Monday's deliveries, or afternoon deliveries) or these journals could represent the day's work for delivery vehicles (such as truck1, truck2).

Using the journals
-------------------

You'll now see how to use the journals to organize your stock management in practice. After installing the module sale_journal look at the list of partners. In the tab 'Sales and Purchases' on any of them you'll now see the field 'Invoicing Journal'.

    .. image:: images/partner_property_view.png
       :align: center

*Partner form in invoicing mode.*

You can create a new *Invoicing Journal* on a partner on the fly. You can show if the invoices should be grouped or not after the generation in the journal. Create a second invoicing journal 'End-of-Month Invoicing' which you can assign to another partner.

    .. image:: images/invoice_mode.png
       :align: center

*Defining an invoicing journal.*

Then enter the data for some orders for these two partners. After entering this order data, the field *Invoicing Mode* is completed automatically from the partner settings. Put these orders into the Invoicing Mode based on items in the second tab. 

Then you'll look at the assembly notes about these orders in the field 'Invoicing Mode' is automatically shown there. Then confirm the different orders in the list.

At the end of the day, the invoicing supervisor can put the list by journal. To do this, use the menu Stock Management > Sorted List > List to invoice. Choose the invoicing journal and all the lists of orders to invoice then open lin list5 view. It's then possible to automatically carry out invoicing by clicking the action Invoice (the gears in the application client).

.. tip::  **Point** *Confirming invoices*

    By default, invoices are generated in the draft state which enables you to modify them before sending them to the customer. But you can confirm all the invoices in one go by selecting them all from the list and doing the action 'Confirm draft invoices'.

At the end of the month the invoicing management does the same work but in the journal 'month-end invoicing'.

You can also enter a journal to confirm / cancel all the orders in one go. Then you can do several quotations and assign them in a journal and confirm or cancel them en masse at once.

    .. image:: images/stock_jounral_form.png
       :align: center

*View of an order journal.*

Advanced elements of stock management
======================================

In this section you'll enter the details of management and control of stocks.

Requirements Calculation
-------------------------

Requirements calculation is the calculation engine that plans, prioritizes and ??? the automated restocking as a function of rules defined in the products.

.. tip:: **Terminology** *Requirements Calculation*

    Requirements Calculation is often called the Scheduler.

    It automatically starts once per day. You can also start it manually using the menu Manufacturing > Start All Schedulers. It then uses the parameters defined in the products, the suppliers, and the company to determine the priorities between the different product orders, deliveries and purchases from suppliers.

Just in Time
-------------

By default, requirements calculation starts automatically once a day. You're advised to make this run overnight to ensure that the system doesn't slow down under the heavy load of scheduling when you're also trying to use it interactively yourselves. To specify the time it starts you can use the menu Administration > Configuration > Planning > Actions Planned. Select the rule called 'Run MRP Scheduler' and modify the date and time of the next execution.

Some companies want to plan the orders progressively as they are entered so they don't wait until the procurement orders are planned the next day. Install the module *mrp_jit* to handle this. Once it's installed each requirement (production or procurement order) will be planned in real time as soon as it's been confirmed.

Then if you make a customer order with a product that's *Make To Order* the quotation request for a supplier will be generated from the confirmation of a customer order. This accelerates the visibility of the different operations.

This mode is not always advisable. Each order will be handled once it's been confirmed. Then if an order is to be delivered in three months the scheduler will reserve goods instock for each order once it's been confirmed. Outside, it would have been more efficient to leave these products available to other commands as it was ample time to replenish before delivery to the customer promise.

If a customer order is configured 'From Order', the scheduler will directly create the corresponding supplier quotation request. Outside, it would have been preferable to wait for several weeks if the lead time enabled you to group the purchase with other future orders.

So the negative effects of working with the Just in Time module are:

* Bad management of priorities amongst orders,

* Additional stocked products.

Planning
----------

You've seen that most Open ERP documents can be changed in a planning view. It's the same for deliveries and goods receipts. You can put them into a calendar view at any time to plan your deliveries or goods receipts.

    .. image:: images/stock_planning.png
       :align: center

*Planning the deliveries of customer products.*

The planned dates on a packing order are put on each stock move line. Then if you have a packing order containing several products you don't have to have all of the lines on the order delivered on the same day. The minimum and maximum dates on a packing order show the earliest and latest dates on the stock move lines for the packing.

If you move a packing order in the calendar view, the planned date on the stock move lines will automatically be moved as a result.

Management of partial deliveries
---------------------------------

Partial deliveries, sometimes call Back Orders, are generated automatically by Open ERP. When you confirm a customer delivery or the receipt of products from suppliers, Open ERP asks you to confirm the quantity delivered or received.

If you leave the quantities alone, Open ERP confirms and closes the order for delivery or reception. If you modify a quantity, Open ERP will automatically generate a second delivery or reception order for the remaining quantities. The first will be confirmed and the second will remain on the list of deliveries (or receipts) waiting.

    .. image:: images/stock_picking_wizard.png
       :align: center

*Confirmation screen for delivered quantities.*

When you open the list of current deliveries, you find the field 'Partial delivery' which shows the reference number of the first delivery sent to the customer. That enable you to easily find the partial orders delivered so that you can treat them as a priority.

Sometimes you'll want to send less product to the customer yet not generate a partial delivery but instead close the delivery note. You may want to do that despite not sending the whole order. To do that you have two possible solutions:

* When confirming the delivery quantities you can reduce the value proposed by Open ERP. The system then generates a partial item that you can cancel immediately.

* Before confirming the delivery, enter the line to modify and change the quantity to deliver.

Receiving supplier products
----------------------------

Open ERP supports three approaches to controlling data entry about products ordered from suppliers:

* Manual data entry,

* Work by controlling the receipts pre-generated by the system,

* Work by selecting the products waiting from the supplier, independent of good receipt documents.

You'll see the configuration of the supplier order in detail in the chapter on purchases.

Manual data entry of goods receipt
-----------------------------------

To enter data about goods receipt manually you must use the menu Stock Management > Goods Receipt > New items received. Then enter the necessary data manually in the goods receipt form.

    .. image:: images/stock_getting.png
       :align: center

*Manual data entry for product receipt.*

Confirming pre-generated goods received
----------------------------------------

If you use supplier orders in Open ERP, product receipts are automatically generated by the system when the purchase order is confirmed. You don't then have to enter any date, but just confirm that the quantities ordered match the quantities received.

In this case Open ERP generates a list of all products waiting to be received from the menu *Stock Management > Incoming Products > Packings to Process*.

    .. image:: images/stock_packing_in.png
       :align: center

*List of items waiting for receipt.*

Then you just look for the  corresponding entry using the supplier name or order reference. Click it and confirm the quantities. If it shows you quantities that differ from the control form, Open ERP will automatically generate another receipt that will be put in waiting. You can let is open or cancel if you don't want to receive products missed by your supplier.

Confirmation by selecting products waiting
---------------------------------------------

The approach shown above is very useful if product receipt corresponds to the original orders. Only if your suppliers deliver items that don't necessarily coincide with the orders it is easier to work by products received rather than by orders.

In this case you can manually create a new goods receipt using the menu *Stock Management > Incoming Products > New Reception Packing*. Instead of entering the product lines manually you can click the button at the lower right *Products not received*. Open ERP then opens all the products waiting from the selected supplier and you can then automatically add some or all of them on your form. This method of encoding is very useful when you're entering goods received at one time but from several orders.

Product routing
----------------

You should install the *stock_location* module for advanced hierarchical stock management operations by product. 

    .. image:: images/product_location.png
       :align: center

*Managing the paths from one location to another in a product form.*

This will enable you to configure logistic rules individually for each product. For example, when a specific product arrives in stores it can automatically be sent to quality control. In this case it must be configured with rules on the product form. The fields that make up those rules are:

* Source location: the rule only applies if a product comes from this location,

* Destination location: the rule only applies if a product ends up in this location,

* Type of move: automatic, manual, automatic with no steps,

* Lead time for move,

* Name of operations: a free text field which will be included in the automatic stock move proposed by Open ERP.

You'll see some examples of using these locations and logistics by product:

* A rentable product,

* A product bought in China, following its freight by ship from port to port, 

* A product that you want to send to quality control before putting it in stocks.

Example 1: A rentable product

A rentable product is just a product delivered to a customer that is expected to be  returned in a few days time. When it has been delivered to the customer, Open ERP must generate a new goods receipt note with a forecast date at the end of the rental period. So you have a list of goods pending receipt for you to confirm when they are returned to your stores. To do this you should configure a product with the following rules:

==================== ==============
Field                Value
==================== ==============
Source location      Customer
Destination location Stock
Type of Movement     Manual
Lead time            15 days
Operation            Product return
==================== ==============

Then when the product is delivered to the customer, Open ERP automatically generates a goods receipt form in the draft state ready for returning it to Stock. This is due in 15 days time. With such a system your forecasts and stock graphs can always be correct in real time.

Example 2: Management of imports by sea

To manage products that follow a complex logistical import path by sea and then into customs, create as many 'Supplier' locations as there are steps, then create rules to move the product from one place to the other during the purchase.

Take a product that has been bought in China and delivered to you stores in Brussels, Belgium. Import by sea take around 7 weeks and must go through the following steps:

* Delivery from the supplier to the port of Shanghai: 2 days,

* Sea transport from Shanghai to the port of Anvers: 1 month,

* Customer at the port of Anvers: 2 weeks,

* Delivery by truch from the port of Anvers to your stores: 3 days.

You want to follow the movement of your products and encode all the documents as each move it made so that you know where your products are at any moment, and can estimate when they are likely to arrive in your stores. To do this, create all the locations for the intermediate steps:

* Shanghai Port,

* Anvers Port,

* Anvers Customs.

Finally, on the product form, create the following rule to show that when purchased, the products don't arrive at your stores directly, but instead at the port of Shanghai. In this example the stores are configured to enter all the products in a location called 'Input'.

==================== ========================
Field                Value
==================== ========================
Source location      Input
Destination location Shanghai Port
Type of Movement     Automatic without steps
Lead time            2 days
Operation            Sending to Shanghai Port
==================== ========================

Then Open ERP will change the usual product reception (which has them arriving in the Input location) to a delivery from this supplier to the external port. The move is automatically carried out because you don't want to do operations at this level manually.

You then have to create a rule on the product form to move it from one location to another:

==================== ==============================
Field                Value
==================== ==============================
Source location      Shanghai Port
Destination location Anvers Port
Type of Movement     Manual
Lead time            30 days
Operation            Sending to Anvers Port by ship
==================== ==============================

==================== =================
Field                Value
==================== =================
Source location      Anvers Port
Destination location Anvers Customs
Type of Movement     Manual
Lead time            15 days
Operation            Customs at Anvers
==================== =================

==================== ==============================
Field                Value
==================== ==============================
Source location      Anvers Customs
Destination location Stock
Type of Movement     Manual
Lead time            3 days
Operation            Truck transport into stock
==================== ==============================

Once the rules have been configured, Open ERP will automatically prepare all the documents needed for the internal stock movements of products from one location to another. These document will be assigned one after another depending on the order defined in the rules definition.

When the company received notification of the arrival at a port or at customers, the corresponding move can be confirmed. You can then follow, using each location:

* where a given product can be found,

* quantities of product awaiting customs,

* lead times for products to get to stores,

* the value of stock in different locations.

Example 3: Quality Control

You can configure the system to put a given product in the Quality Control bay automatically when it arrives in your company. To do that you just need to configure a rule for the product to be placed in the Quality Control location rather than the Input location when the product is received from the supplier.

==================== ==============================
Field                Value
==================== ==============================
Source location      Input
Destination location Quality Control
Type of Movement     Manual
Lead time            0 days
Operation            Quality Control
==================== ==============================

Once this product has been received, Open ERP will then automatically manage the request for an internal movement to send it to the “Quality Control” location.

